
var getCookie = require('./getCookie.js');
var lang = getCookie('org.springframework.web.servlet.i18n.CookieLocaleResolver.LOCALE'); // 默认返回 en_US
//require('./js/libs/jquery-1.11.2.min.js') // you should not see me
require('./libs/bootstrap.min.js');
require('./libs/FV/formValidation.min.js');
require('./libs/FV/bootstrap.min.js');
require('./libs/FV/i18n.min.js');
require('./libs/summernote/summernote.min.js');
require('./ck_lang.js');
require('./ck_ajax_setup.js');

$(document).ready(function() {
    $('#f-complaint-form').formValidation({
        framework: 'bootstrap',
        addOns: {
            i18n: {}
        },       
        excluded: [':disabled'],
        icon: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            'f-complaint-email': {
                selector: '.f-complaint-email',
                validators: {
                    notEmpty: {
                        message: {
                            en_US: 'The email is required',
                            zh_CN: '邮箱不能为空'
                        }
                    },
                    emailAddress: {
                        message: {
                            en_US: 'The value is not a valid email address',
                            zh_CN: '输入的值不是一个有效的邮箱地址'
                        }
                    }
                }
            },
            'f-complaint-title': {
                selector: '.f-complaint-title',
                validators: {
                    notEmpty: {
                        message: {
                            en_US: 'The title is required',
                            zh_CN: '题目不能为空'
                        }
                    },
                    stringLength: {
                        min: 6,                      
                        message: {
                        	en_US: 'The title must be more than 6 characters long',
                        	zh_CN: '标题长度必须大于6个字符'
                        }
                    }                  
                }
            },
            'f-complaint-content': {
                selector: '.f-complaint-content',
                validators: {
                    callback: {
                        message: {
                            en_US: 'The content is required and cannot be empty',
                            zh_CN: '内容不能为空'
                        },
                        callback: function(value, validator, $field) {
                            var code = $('.f-complaint-content').code();
                            // <p><br></p> is code generated by Summernote for empty content
                            return (code !== '' && code !== '<p><br></p>');
                        }
                    }
                }
            }
        }
    }).find('.f-complaint-content')
            .summernote({
                height: 200,                 // set editor height
            })
            .on('summernote.change', function(customEvent, contents, $editable) {
                // Revalidate the content when its value is changed by Summernote
                $('#f-complaint-form').formValidation('revalidateField', 'f-complaint-content');
            })
            .on('err.validator.fv', function(e, data) {
                data.element
                        .data('fv.messages')
                        .find('.help-block[data-fv-for="' + data.field + '"]').hide()
                        .filter('[data-fv-validator="' + data.validator + '"]').show();
            });
    $('#f-complaint-form').formValidation('setLocale', lang);
});

